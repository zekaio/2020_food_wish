# 食愿记

错误以http状态码的形式返回，错误信息在`message`字段中，可以直接将`message`显示给用户

## 全局错误码

`401`：未绑定微信账号

`410`：活动未开始/已结束，具体查看`message`字段

`412`：参数错误，直接将`message`字段中的内容显示给用户

`500`：服务器错误



## 仅测试

####  baseurl=`https://zekaio.cn/2020/food_wish/api`

### /set_open_id

**请求方法 POST**

**请求参数**

| 参数名 | 参数类型 | 说明                                |
| ------ | -------- | ----------------------------------- |
| openid | stirng   | 将open_id设为传入的值，代替微信登录 |

**预先设置好的用户**

| openid     | 说明                              |
| ---------- | --------------------------------- |
| lotteryer1 | 剩余抽奖次数100次，可用于测试抽奖 |
| lotteryer2 | 剩余抽奖次数100次，可用于测试抽奖 |
| lotteryer3 | 剩余抽奖次数100次，可用于测试抽奖 |
| poster1    | 剩余发帖次数100次                 |
| poster2    | 剩余发帖次数100次                 |
| poster3    | 剩余发帖次数100次                 |



## 获取用户信息

### /info

**请求方法 GET**

**返回参数**

| 参数名       | 参数类型 | 说明                       |
| ------------ | -------- | -------------------------- |
| help         | int      | 剩余助愿次数               |
| wish         | int      | 剩余许愿次数               |
| lottery      | int      | 剩余抽奖次数               |
| post         | int      | 剩余发帖次数               |
| has_username | bool     | 是否填写过广场的昵称       |
| username     | string   | 广场的昵称，没填过返回null |

**返回参数示例**

```json
{
    "help": 3,
    "wish": 3,
    "lottery": 3,
    "post": 3,
    "has_username": true,
    "username": "昵称"
}
```



## 许愿页面，许愿

### /playground/player/wish

**请求方式 POST**

**请求参数**

| 参数名  | 类型   | 说明               |
| ------- | ------ | ------------------ |
| title   | string | 许愿文案           |
| content | string | 许愿内容           |
| paper   | int    | 选择的信纸对应的id |
| name    | string | 姓名               |
| tel     | string | 手机号             |
| wechat  | string | 微信号             |

**请求参数示例**

```json
{
    "title": "许愿文案",
    "content": "许愿内容",
    "paper": 1,
    "name": "姓名",
    "tel": "电话",
    "wechat": "微信号"
}
```

**错误信息**

`406`：今日许愿次数已用完

`412`：手机号错误


## 助愿页面，抽取愿望

### /playground/others/wish

**请求方式 GET**

**请求参数**

| 参数名 | 类型 | 说明                    |
| ------ | ---- | ----------------------- |
| limit  | int  | 返回愿望的数目，默认3条 |

**返回参数**

| 参数名 | 类型  | 说明         |
| ------ | ----- | ------------ |
| wishes | array | 返回多条愿望 |

**wishes**

| 参数名  | 类型   | 说明                                                         |
| ------- | ------ | ------------------------------------------------------------ |
| id      | int    | 愿望在数据库中的id，选择帮助TA时传回给后端                   |
| name    | string | 许愿者姓名                                                   |
| tel     | string | 许愿者电话                                                   |
| wechat  | string | 许愿者微信                                                   |
| title   | string | 愿望文案                                                     |
| content | string | 愿望内容                                                     |
| status  | int    | 0：未被人帮助，1：被人帮助但是还未完成，2：已完成未确认，3：完成并已确认 |
| paper   | int    | 信纸id                                                       |

**返回参数示例**

```json
{
	"wishes": [
        {
            "id": 3,
            "name": "姓名",
            "wechat": "微信号",
            "tel": "电话号码",
            "title": "愿望文案",
            "content": "愿望内容",
            "status":0,
            "paper": 2
        },
        {
            "id": 5,
            "name": "姓名",
            "wechat": "微信号",
            "tel": "电话号码",
            "title": "愿望文案",
            "content": "愿望内容",
            "status":0,
            "paper": 2
        }
    ]
}
```



## 助愿页面，选择帮助TA

### /playground/others/wish

**请求方式 POST**

**请求参数**

| 参数名 | 类型 | 说明                                         |
| ------ | ---- | -------------------------------------------- |
| id     | int  | GET /playground/others/wish 获取到的愿望的id |

**错误信息**

`404`：愿望不存在或是已被其他人领取

`406`：今日助愿次数已用完

`412`：无法帮助自己的愿望



## 收藏夹页面-我的许愿，获取所有愿望

### /collection/player/wish

**请求方式 GET**

**返回参数**

| 参数名 | 类型  | 说明     |
| ------ | ----- | -------- |
| wishes | array | 多个愿望 |

**wishes**

| 参数名  | 类型   | 说明                                                         |
| ------- | ------ | ------------------------------------------------------------ |
| id      | int    | 愿望在数据库中的id                                           |
| name    | string | 许愿者姓名                                                   |
| tel     | string | 许愿者电话                                                   |
| wechat  | string | 许愿者微信                                                   |
| title   | string | 愿望文案                                                     |
| content | string | 愿望内容                                                     |
| status  | int    | 0：未被人帮助，1：被人帮助但是还未完成，2：已完成未确认，3：完成并已确认 |
| paper   | int    | 信纸id                                                       |

**返回参数示例**

```json
{
	"wishes": [
        {
            "id": 3,
            "name": "姓名",
            "wechat": "微信号",
            "tel": "电话号码",
            "title": "愿望文案",
            "content": "愿望内容",
            "status":0,
            "paper": 2
        },
        {
            "id": 5,
            "name": "姓名",
            "wechat": "微信号",
            "tel": "电话号码",
            "title": "愿望文案",
            "content": "愿望内容",
            "status":0,
            "paper": 2
        }
    ]
}
```



## 收藏夹页面-我的许愿，许愿者确认愿望已经被完成

### /collection/player/wish

**请求方式 POST**

**请求参数**

| 参数名 | 类型 | 说明     |
| ------ | ---- | -------- |
| id     | int  | 愿望的id |

**错误信息**

`404`：愿望不存在

`406`：愿望不是当前用户许的

`409`：助愿者还未确认已实现



## 收藏夹页面-我的助愿，获取所有愿望

### /collection/others/wish

**请求方式 GET**

**返回参数**

| 参数名 | 类型  | 说明                       |
| ------ | ----- | -------------------------- |
| wishes | array | 愿望内容，没有则返回空数组 |

**wishes**

| 参数名  | 类型   | 说明                                                         |
| ------- | ------ | ------------------------------------------------------------ |
| id      | int    | 愿望在数据库中的id，点击我已完成时传回给后端                 |
| name    | string | 许愿者姓名                                                   |
| tel     | string | 许愿者电话                                                   |
| wechat  | string | 许愿者微信                                                   |
| title   | string | 愿望文案                                                     |
| content | string | 愿望内容                                                     |
| status  | int    | 0：未被人帮助，1：被人帮助但是还未完成，2：已完成未确认，3：完成并已确认 |
| paper   | int    | 信纸id                                                       |

**返回参数示例**

```json
{
	"wishes": [
        {
            "id": 3,
            "name": "姓名",
            "wechat": "微信号",
            "tel": "电话号码",
            "title": "愿望文案",
            "content": "愿望内容",
            "status":0,
            "paper": 2
        },
        {
            "id": 5,
            "name": "姓名",
            "wechat": "微信号",
            "tel": "电话号码",
            "title": "愿望文案",
            "content": "愿望内容",
            "status":0,
            "paper": 2
        }
    ]
}
```



## 收藏夹页面-我的助愿，我已实现/放弃

### /collection/others/wish

**请求方式 POST**

**请求参数**

| 参数名 | 类型 | 说明                                   |
| ------ | ---- | -------------------------------------- |
| id     | int  | GET /collection/others/wish 获取到的id |
| status | int  | 0：放弃，1：我已实现                   |

**错误信息**

`404`：愿望不存在

`406`：愿望不是当前用户领取的

`409`：愿望未被领取或已确认实现



## 抽奖页面，抽奖按钮

### /playground/lottery

**请求方式 POST**

**返回参数**

| 参数名  | 类型 | 说明              |
| ------- | ---- | ----------------- |
| section | int  | 图鉴对应的id(0-7) |

**错误信息**

`406`：剩余抽奖次数为0

`409`：图鉴已集齐



## 抽奖--图鉴页面，获取抽奖进度

### /playground/lottery

**请求方法 GET**

**返回参数**

| 参数名   | 类型       | 说明                                              |
| -------- | ---------- | ------------------------------------------------- |
| progress | array[int] | 八个食物的收集进度0-3（按id排序，第一个是id=0的） |

**返回参数示例**

```json
{
	"progress":[1,2,3,2,1,3,4,5]
}
```



## 广场页面，获取帖子

### /playground/square

**请求方式 GET**

**请求参数**

| 参数名 | 类型 | 说明                                                   |
| ------ | ---- | ------------------------------------------------------ |
| limit  | int  | 一次返回多少条帖子，默认5                              |
| offset | int  | 上一次获取到的数组的最后一项的id，第一次请求就不用传入 |

**返回参数**

| 参数名 | 类型  | 说明     |
| ------ | ----- | -------- |
| posts  | array | 多条帖子 |

**posts**

| 参数名  | 类型          | 说明                                                         |
| ------- | ------------- | ------------------------------------------------------------ |
| name    | string        | 用户姓名                                                     |
| content | string        | 帖子内容                                                     |
| pics    | Array[string] | 返回数组，如果没有则返回空数组，图片路径，直接插入到img的src属性中 |
| id      | int           | 帖子的id                                                     |

**返回参数示例**

```json
{
	"posts": [
        {
            "name": "用户姓名",
            "content": "帖子内容",
            "pics": ["./imgs/1.png", "./imgs/2.png"],
            "id":3
        },
        {
            "name": "用户姓名",
            "content": "帖子内容",
            "pics": ["./imgs/3.png", "./imgs/4.png"],
            "id":2
        }
    ]
}
```



## 广场，设置昵称

### /info

**请求方法 POST**

**请求参数**

| 参数名   | 类型   | 说明 |
| -------- | ------ | ---- |
| username | string | 昵称 |

**错误信息**

`406`：已设置过昵称



## 广场，发帖

### /playground/square

**请求方法 POST**

**请求参数**

| 参数名  | 类型          | 说明                                                         |
| ------- | ------------- | ------------------------------------------------------------ |
| content | string        | 帖子内容                                                     |
| pics_id | Array[string] | 调用微信上传图片的接口获取到的file_id，就算只上传一张图片也传入数组，没有就不传这个参数 |

**请求参数示例**

```json
{
    "content": "帖子内容",
    "pics_id": ["只有一张图片也像这样返回数组，没有图片不用传入这个参数"]
}
```

**错误信息**

`404`：没有设置昵称

`406`：发帖次数已用完

`412`：图片上传|保存失败

